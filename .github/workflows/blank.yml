name: MariaDB Server Setup

on: [push, pull_request]

jobs:
  setup-mariadb:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install MariaDB
      run: |
        sudo apt update
        sudo apt install -y mariadb-server
        sudo systemctl start mariadb
        sudo systemctl enable mariadb

    - name: Additional Setup
      run: |
        sudo mkdir /mnt/ramdisk
        sudo mount -t tmpfs -o size=1000m tmpfs /mnt/ramdisk
        sudo df -h | grep mnt
        sudo mkdir -p /mnt/ramdisk/mariadb
        sudo chown -R mysql:mysql /mnt/ramdisk/mariadb
        sudo /usr/bin/mysql_install_db --user=mysql --basedir="/usr/" --datadir=/mnt/ramdisk/mariadb
        sudo systemctl restart mariadb
        sudo mysql -S /run/mysqld/mysqld.sock --execute "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('');"
        mysqladmin -u root --socket=/run/mysqld/mysqld.sock ping
